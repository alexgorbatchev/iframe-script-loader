// Generated by CoffeeScript 1.8.0
var iframeScript, parallel, scriptLoader,
  __slice = [].slice;

iframeScript = require('iframe-script');

parallel = require('run-parallel');

scriptLoader = require('scriptloader');

module.exports = function(scripts, callback) {
  var jobs, results;
  jobs = [];
  results = {};
  return iframeScript((function() {
    return {
      doc: document,
      win: window
    };
  }), {}, function(err, _arg) {
    var doc, item, win, _fn, _i, _len;
    doc = _arg.doc, win = _arg.win;
    _fn = function(item) {
      var keys, src, _j;
      keys = 2 <= item.length ? __slice.call(item, 0, _j = item.length - 1) : (_j = 0, []), src = item[_j++];
      return jobs.push(function(done) {
        return scriptLoader(doc, src, function(err) {
          var key, _k, _len1;
          for (_k = 0, _len1 = keys.length; _k < _len1; _k++) {
            key = keys[_k];
            results[key] = win[key];
          }
          return done(err);
        });
      });
    };
    for (_i = 0, _len = scripts.length; _i < _len; _i++) {
      item = scripts[_i];
      _fn(item);
    }
    return parallel(jobs, function(err) {
      return callback(err, results);
    });
  });
};
